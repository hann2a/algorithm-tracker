<!-- _includes/calendar.html -->
<!-- Dynamic Calendar - reads from site.time and posts -->

{% assign now = site.time %}
{% assign current_year = now | date: "%Y" %}
{% assign current_month = now | date: "%m" | plus: 0 %}
{% assign current_day = now | date: "%d" | plus: 0 %}

{% assign month_names = "January,February,March,April,May,June,July,August,September,October,November,December" | split:
"," %}
{% assign month_name = month_names[current_month | minus: 1] %}

<div class="bg-white rounded-2xl border border-gray-100 shadow-sm p-8">
  <!-- Calendar Header -->
  <div class="flex items-center justify-between mb-8">
    <h2 class="text-2xl font-bold text-gray-900" id="calendar-title">{{ month_name }} {{ current_year }}</h2>
    <div class="flex items-center gap-2">
      <button class="p-2 rounded-lg hover:bg-gray-100 text-gray-400 hover:text-gray-600 transition-colors">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"
          stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
        </svg>
      </button>
      <button class="p-2 rounded-lg hover:bg-gray-100 text-gray-400 hover:text-gray-600 transition-colors">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"
          stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
        </svg>
      </button>
    </div>
  </div>

  <!-- Calendar Grid -->
  <div class="grid grid-cols-7 gap-2">
    <!-- Weekday Headers -->
    <div class="text-center text-sm font-medium text-gray-400 py-3">Sun</div>
    <div class="text-center text-sm font-medium text-gray-400 py-3">Mon</div>
    <div class="text-center text-sm font-medium text-gray-400 py-3">Tue</div>
    <div class="text-center text-sm font-medium text-gray-400 py-3">Wed</div>
    <div class="text-center text-sm font-medium text-gray-400 py-3">Thu</div>
    <div class="text-center text-sm font-medium text-gray-400 py-3">Fri</div>
    <div class="text-center text-sm font-medium text-gray-400 py-3">Sat</div>
  </div>

  <!-- Calendar Days Container (generated by JavaScript) -->
  <div id="calendar-grid" class="grid grid-cols-7 gap-2">
    <!-- Days will be generated dynamically -->
  </div>

  <!-- Legend -->
  <div class="flex items-center justify-center gap-8 mt-8 pt-6 border-t border-gray-100">
    <div class="flex items-center gap-2">
      <span class="w-2.5 h-2.5 rounded-full bg-red-500"></span>
      <span class="text-sm text-gray-500">Hard</span>
    </div>
    <div class="flex items-center gap-2">
      <span class="w-2.5 h-2.5 rounded-full bg-yellow-400"></span>
      <span class="text-sm text-gray-500">Medium</span>
    </div>
    <div class="flex items-center gap-2">
      <span class="w-2.5 h-2.5 rounded-full bg-blue-500"></span>
      <span class="text-sm text-gray-500">Easy</span>
    </div>
  </div>
</div>

<script>
  // Posts data from Jekyll
  const posts = [
    {% for post in site.posts %}
  {
    date: "{{ post.date | date: '%Y-%m-%d' }}",
      title: "{{ post.title | escape }}",
        summary: "{{ post.summary | default: post.type | escape }}",
          difficulty: "{{ post.difficulty | default: 'easy' }}",
            url: "{{ post.url | prepend: site.baseurl }}"
  } {% unless forloop.last %}, {% endunless %}
  {% endfor %}
];

  // Current date info
  const currentYear = {{ current_year }};
  const currentMonth = {{ current_month }};
  const currentDay = {{ current_day }};

  // Get first day of month (0=Sun, 6=Sat)
  function getFirstDayOfMonth(year, month) {
    return new Date(year, month - 1, 1).getDay();
  }

  // Get days in month
  function getDaysInMonth(year, month) {
    return new Date(year, month, 0).getDate();
  }

  // Find post for a specific date
  function getPostForDate(year, month, day) {
    const dateStr = `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
    return posts.find(p => p.date === dateStr);
  }

  // Difficulty color mapping
  const difficultyColors = {
    'hard': 'bg-red-500',
    'medium': 'bg-yellow-400',
    'easy': 'bg-blue-500'
  };

  // Generate calendar
  function generateCalendar() {
    const grid = document.getElementById('calendar-grid');
    const firstDay = getFirstDayOfMonth(currentYear, currentMonth);
    const daysInMonth = getDaysInMonth(currentYear, currentMonth);

    let html = '';

    // Empty cells before first day
    for (let i = 0; i < firstDay; i++) {
      html += '<div class="aspect-square"></div>';
    }

    // Days of month
    for (let day = 1; day <= daysInMonth; day++) {
      const post = getPostForDate(currentYear, currentMonth, day);
      const isToday = day === currentDay;

      if (post) {
        const colorClass = difficultyColors[post.difficulty] || 'bg-blue-500';
        html += `
        <a href="${post.url}" class="calendar-cell aspect-square rounded-lg border ${isToday ? 'border-2 border-blue-500 bg-blue-50' : 'border-gray-100 bg-white'} hover:bg-gray-50 flex items-center justify-center relative cursor-pointer transition-colors group">
          <span class="text-sm ${isToday ? 'font-bold text-blue-600' : 'font-medium text-gray-700'}">${day}</span>
          <span class="absolute top-1.5 right-1.5 w-2 h-2 rounded-full ${colorClass}"></span>
          <div class="tooltip absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-48 p-3 bg-gray-900 text-white text-xs rounded-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all z-10 pointer-events-none shadow-lg">
            <div class="font-medium truncate">${post.title}</div>
            <div class="text-gray-400 mt-1">${post.summary.substring(0, 40)}${post.summary.length > 40 ? '...' : ''}</div>
            <div class="absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-gray-900"></div>
          </div>
        </a>
      `;
      } else {
        html += `
        <div class="calendar-cell aspect-square rounded-lg border ${isToday ? 'border-2 border-blue-500 bg-blue-50' : 'border-gray-100 bg-white'} flex items-center justify-center">
          <span class="text-sm ${isToday ? 'font-bold text-blue-600' : 'font-medium text-gray-400'}">${day}</span>
        </div>
      `;
      }
    }

    grid.innerHTML = html;
  }

  // Initialize
  document.addEventListener('DOMContentLoaded', generateCalendar);
</script>